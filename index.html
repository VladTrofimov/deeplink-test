<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Twitter DeepLink Auto Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;font-family:Arial,sans-serif;text-align:center;padding:16px}
    code{background:#f4f4f4;padding:2px 6px;border-radius:4px}
  </style>
  <script>
    function getParam(name, def) {
      const u = new URL(location.href);
      return u.searchParams.get(name) ?? def;
    }

    function tryOpen() {
      const user     = getParam('user',  'elonmusk');
      const delayMs  = Math.max(300, parseInt(getParam('delay','1000'),10) || 1000);
      const fallback = getParam('fallback','https://play.google.com/store/apps/details?id=com.twitter.android');

      const intentUrl  = `intent://user?screen_name=${encodeURIComponent(user)}#Intent;scheme=twitter;package=com.twitter.android;S.browser_fallback_url=${encodeURIComponent('https://twitter.com/'+user)};end`;
      const schemeUrl  = `twitter://user?screen_name=${encodeURIComponent(user)}`;

      let navigatedAway = false;
      let timer = null;

      const cancel = () => {
        if (!navigatedAway) {
          navigatedAway = true;
          if (timer) clearTimeout(timer);
        }
      };

      document.addEventListener('visibilitychange', () => {
        if (document.hidden || document.visibilityState === 'hidden') cancel();
      });
      window.addEventListener('pagehide', cancel);
      try {
        location.replace(intentUrl);
      } catch (_) {}

      timer = setTimeout(() => {
        if (!navigatedAway) location.replace(fallback);
      }, delayMs);

      setTimeout(() => {
        if (!navigatedAway) location.href = schemeUrl;
      }, 80);

      document.getElementById('info').textContent =
        `intent: ${intentUrl}\nbackup scheme: ${schemeUrl}\nfallback: ${fallback}\ndelay: ${delayMs}ms`;
    }

    document.addEventListener('DOMContentLoaded', tryOpen);
  </script>
</head>
<body>
  <h1>Twitter DeepLink Auto</h1>
  <pre id="info">initâ€¦</pre>
</body>
</html>
